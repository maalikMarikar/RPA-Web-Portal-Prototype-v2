@page
@model RPA_Web_Portal_Prototype_v2.Views.MainPage.InputterPage

@{
    
}

<!doctype html>
<html lang="eng">
<head>
    <title>Branch Inputter Page</title>
    
</head>
<body class="min-h-screen" style="font-family: cursive;">

    <div class="flex flex-col min-h-screen">
        <div class="bg-[#333333] text-white flex-[1] sticky top-0 border-blue-600 border-b-2 border-b flex p-2 shadow-lg">

            <div class="flex-[1] flex flex-col items-start justify-center font-bold ">
                <!-- <span>Amana Bank PLC</span>
                <span>RPA Web Portal</span>
                <span>Branch-Wise Inputter</span> -->
                <img src="uipath.png" class="max-h-16 w-auto" />



            </div>

            <div class="flex-[1] flex flex-col md:flex-row items-center justify-center font-bold text-sm md:space-x-4 space-y-2 md:space-y-0">
                <span>User: <span id="usir" class="bg-blue-500 p-1 rounded-lg"></span></span>
                <span>Branch: <span id="brn" class="bg-blue-500 p-1 rounded-lg"></span></span>
                <span>Date: <span id="dtn" class="bg-blue-500 p-1 rounded-lg"></span></span>
            </div>

            <div class="flex-[1] flex items-center justify-end">
                <button class="bg-blue-500 p-2 rounded-lg hover:bg-blue-700">Log-Out</button>
            </div>
        </div>

        <div class="flex-[500] flex">
            <div class="flex-[1] bg-[#333333] text-white p-2 space-y-2 border-blue-600 border-r-2 border-r shadow-lg">
                <div class="w-full text-center font-bold text-xl">Settlements</div>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700" onclick="populateFormArea('RegularSettlement')">Regular Settlement</button>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700" onclick="refresh()">Early Settlement Ijara</button>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700">WMT Full Settlement</button>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700">WMT Partial Settlement</button>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700">DM Full Settlement</button>
                <div class="w-full text-center font-bold text-xl">Disbursements</div>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700">Extended Murabaha</button>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700">Local Murabaha</button>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700">WMT Disbursement</button>
                <button class="w-full p-2 bg-blue-500 rounded-lg hover:bg-blue-700">Ijara Disbursement</button>
            </div>

            <div id="formArea" class="flex-[5] p-4 bg-[#333333] text-white">
                form area is here
            </div>
        </div>

    </div>

</body>
<script>

    function captureUser(){
        document.getElementById("userr").innerHTML = GetCookie("uzn")
    }
    
    document.getElementById("usir").innerHTML = GetCookie("uzn");
    
    
    document.getElementById("brn").innerHTML = GetCookie("brnch");


    document.getElementById("dtn").innerHTML = GetCookie("dtnow");
    


    async function populateFormArea(name){
        let response =  await fetch(`/MainPage/${name}/`)
        document.getElementById("formArea").innerHTML = await response.text();

        let uz = GetCookie("uzn");
        let usrInput = document.querySelector("#formArea input[name='userr']")
        if (usrInput) usrInput.value = uz;
    }

   function GetCookie(name){
       let cookies = document.cookie.split(";").map(i=>i.trim())
       for(let ck of cookies){
           if(ck.startsWith(name + "=")){
               return decodeURIComponent(ck.substring(name.length + 1))
           }
       }
       return null
   }

    async function refresh(){
        try{
            const refRes = await fetch("/Login/Refresh", {
                method: "POST",
                credentials: "include"
            });
            if(!refRes.ok){
                throw new Error("Refresh Failed")
            }
        }
        catch(e){
            alert(e)
        }
    }
    
    // window.onload = async function(){
    //     let refres = await fetch("/Login/Refresh/")
    // }

    window.onload = async function() {
        try {
            await refresh(); // call your existing function
            console.log("Session refreshed successfully");
        } catch (e) {
            alert("Refresh failed: " + e.message);
            // Optionally redirect to login page if refresh fails
            window.location.href = "/Login/";
        }
    };


</script>

</html>




